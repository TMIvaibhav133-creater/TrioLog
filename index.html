<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TrioLog â€“ Attendance System</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginSection" class="container">
  <h2>TrioLog â€“ Sign In</h2>
  <input id="username" type="text" placeholder="Enter email" />
  <input id="password" type="password" placeholder="Enter password" />
  <button id="manualSignIn">Sign In</button>
  <button class="google-btn" id="googleLogin"><i class="fab fa-google"></i> Sign in with Google</button>
  <button class="apple-btn" id="appleLogin"><i class="fab fa-apple"></i> Sign in with Apple</button>
  <button class="phone-btn" id="phoneLogin"><i class="fas fa-phone"></i> Sign in with Phone</button>
</div>

<!-- ATTENDANCE PAGE -->
<div id="attendanceSection" class="hidden">
  <h2>TrioLog â€“ Trio World Academy</h2>
  <div class="top-buttons">
    <button class="add-btn" id="addStudentBtn">+ Add Student</button>
    <button class="save-btn" id="saveAttendanceBtn">Save Attendance</button>
    <button class="view-btn" id="viewPastBtn">View Past Attendance</button>
    <button class="logout-btn" id="logoutBtn">Logout</button>
  </div>
  <div id="studentList"></div>
</div>

<!-- ADD STUDENT MODAL -->
<div id="addModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" id="closeAddModal">&times;</span>
    <h3>Add Student</h3>
    <input id="sName" placeholder="Name" />
    <input id="sGrade" placeholder="Grade" />
    <input id="sSection" placeholder="Section" />
    <input id="sSubject" placeholder="Subject" />
    <input id="sPhoto" type="file" accept="image/*" onchange="previewPhoto(event)" />
    <img id="photoPreview" />
    <button class="add-btn" id="saveStudentBtn">Add</button>
  </div>
</div>

<!-- CALENDAR MODAL -->
<div id="calendarModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" id="closeCalendar">&times;</span>
    <h3>Past Attendance</h3>
    <div>
      <select id="monthSelect"></select>
      <select id="yearSelect"></select>
    </div>
    <div class="calendar" id="calendarDays"></div>
    <button class="view-btn" id="viewAttendanceBtn">View Attendance</button>
  </div>
</div>

<script>
// ===== LOGIN =====
let currentUser=null;
const loginSection=document.getElementById("loginSection");
const attendanceSection=document.getElementById("attendanceSection");
const studentList=document.getElementById("studentList");

document.getElementById("manualSignIn").onclick=()=>{
  const u=document.getElementById("username").value;
  const p=document.getElementById("password").value;
  if(!u||!p) return alert("Enter username and password!");
  currentUser=u; loginSection.classList.add("hidden"); attendanceSection.classList.remove("hidden"); loadStudents();
};
document.getElementById("googleLogin").onclick=()=>{
  const email=prompt("Enter Gmail (@gmail.com)"); 
  if(!email||!email.endsWith("@gmail.com")) return alert("Invalid Gmail!"); 
  currentUser=email; loginSection.classList.add("hidden"); attendanceSection.classList.remove("hidden"); loadStudents();
};
document.getElementById("appleLogin").onclick=()=>{
  const email=prompt("Enter Apple ID (@icloud.com/@appleid.com)");
  if(!email||(!email.endsWith("@icloud.com")&&!email.endsWith("@appleid.com"))) return alert("Invalid Apple ID!");
  currentUser=email; loginSection.classList.add("hidden"); attendanceSection.classList.remove("hidden"); loadStudents();
};
const countryCodes={"+1":"USA","+44":"UK","+91":"India","+61":"Australia","+81":"Japan","+49":"Germany","+33":"France"};
document.getElementById("phoneLogin").onclick=()=>{
  let phone=prompt("Enter phone with country code, e.g. +91XXXXXXXXXX");
  if(!phone) return;
  const codeMatch=phone.match(/^\+\d{1,4}/);
  if(!codeMatch) return alert("Invalid code!");
  const code=codeMatch[0];
  if(!countryCodes[code]) return alert("Unknown country code!");
  alert(`Detected country: ${countryCodes[code]}`);
  currentUser=phone; loginSection.classList.add("hidden"); attendanceSection.classList.remove("hidden"); loadStudents();
};
document.getElementById("logoutBtn").onclick=()=>{ loginSection.classList.remove("hidden"); attendanceSection.classList.add("hidden"); studentList.innerHTML=""; currentUser=null; };

// ===== ADD STUDENT =====
const addModal=document.getElementById("addModal");
document.getElementById("addStudentBtn").onclick = () => {
  document.getElementById("sName").value = "";
  document.getElementById("sGrade").value = "";
  document.getElementById("sSection").value = "";
  document.getElementById("sSubject").value = "";
  document.getElementById("sPhoto").value = "";
  document.getElementById("photoPreview").src = "";
  addModal.classList.add("active");
};
document.getElementById("closeAddModal").onclick=()=>addModal.classList.remove("active");
function previewPhoto(e){document.getElementById("photoPreview").src=URL.createObjectURL(e.target.files[0]);}

document.getElementById("saveStudentBtn").onclick=()=>{
  const name=document.getElementById("sName").value;
  const grade=document.getElementById("sGrade").value;
  const section=document.getElementById("sSection").value;
  const subject=document.getElementById("sSubject").value;
  const file=document.getElementById("sPhoto").files[0];
  if(!name||!grade||!section||!subject||!file) return alert("Fill all fields!");
  const div=document.createElement("div");
  div.classList.add("student-card");
  div.dataset.info=JSON.stringify({name,grade,section,subject});
  div.innerHTML=`
    <img src="${URL.createObjectURL(file)}" />
    <div class="info">${name}<br>Grade ${grade} ${section}<br>${subject}</div>
    <div>
      <button onclick="selectStatus(this,'Present')">Present</button>
      <button onclick="selectStatus(this,'Half Day')">Half Day</button>
      <button onclick="selectStatus(this,'Absent')">Absent</button>
      <button onclick="deleteStudent(this)" style="background:#d50000;">Delete Student</button>
    </div>`;
  studentList.appendChild(div); addModal.classList.remove("active"); saveStudents();
};

// ===== STATUS MARKING =====
function selectStatus(btn,status){
  const card=btn.closest(".student-card");
  card.dataset.status=status;
  btn.parentElement.querySelectorAll("button").forEach(b=>{b.classList.remove("active"); b.style.background="#555";});
  btn.classList.add("active");
  btn.style.background=status==='Present'? '#006400':status==='Half Day'? '#b8860b':'#8b0000';
}

// ===== DELETE STUDENT =====
function deleteStudent(btn){if(!confirm("Delete this student?")) return; btn.closest(".student-card").remove(); saveStudents();}

// ===== SAVE ATTENDANCE =====
document.getElementById("saveAttendanceBtn").onclick=()=>{
  const students=[];
  studentList.querySelectorAll(".student-card").forEach(s=>{
    students.push({info:s.dataset.info,status:s.dataset.status||"None",img:s.querySelector("img").src});
  });
  const key="attendance_"+currentUser;
  const oldData=JSON.parse(localStorage.getItem(key))||[];
  const today=new Date();
  const dateStr=`${today.getDate()}/${today.getMonth()+1}/${today.getFullYear()}`;
  const filtered=oldData.filter(d=>d.date!==dateStr);
  filtered.push({date:dateStr,students});
  localStorage.setItem(key,JSON.stringify(filtered));
  alert("ðŸŽ‰ Attendance Saved! ðŸŽ‰");
};

// ===== SAVE & LOAD STUDENTS =====
function saveStudents(){
  const arr=[];
  studentList.querySelectorAll(".student-card").forEach(s=>{
    arr.push({img:s.querySelector("img").src, info:s.dataset.info, status:s.dataset.status||"None"});
  });
  if(currentUser) localStorage.setItem("students_"+currentUser,JSON.stringify(arr));
}
function loadStudents(){
  const arr=JSON.parse(localStorage.getItem("students_"+currentUser))||[];
  studentList.innerHTML="";
  arr.forEach(obj=>{
    const div=document.createElement("div");
    div.classList.add("student-card");
    div.dataset.info=obj.info;
    div.dataset.status=obj.status||"None";
    const info=JSON.parse(obj.info);
    div.innerHTML=`<img src="${obj.img}" />
    <div class="info">${info.name}<br>Grade ${info.grade} ${info.section}<br>${info.subject}</div>
    <div>
      <button onclick="selectStatus(this,'Present')" class="${obj.status==='Present'?'active':''}">Present</button>
      <button onclick="selectStatus(this,'Half Day')" class="${obj.status==='Half Day'?'active':''}">Half Day</button>
      <button onclick="selectStatus(this,'Absent')" class="${obj.status==='Absent'?'active':''}">Absent</button>
      <button onclick="deleteStudent(this)" style="background:#d50000;">Delete Student</button>
    </div>`;
    studentList.appendChild(div);
  });
}

// ===== CALENDAR =====
const calendarModal=document.getElementById("calendarModal");
const calendarDays=document.getElementById("calendarDays");
const viewAttendanceBtn=document.getElementById("viewAttendanceBtn");
const monthSelect=document.getElementById("monthSelect");
const yearSelect=document.getElementById("yearSelect");
let selectedDay=null;

document.getElementById("viewPastBtn").onclick=()=>{
  calendarModal.classList.add("active");
  populateCalendar();
};
document.getElementById("closeCalendar").onclick=()=>{ calendarModal.classList.remove("active"); selectedDay=null; };

function populateCalendar(){
  const now=new Date();
  const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  monthSelect.innerHTML=""; yearSelect.innerHTML="";
  for(let i=0;i<12;i++){ const opt=document.createElement("option"); opt.value=i; opt.text=months[i]; if(i===now.getMonth()) opt.selected=true; monthSelect.appendChild(opt);}
  for(let y=now.getFullYear()-2;y<=now.getFullYear()+2;y++){ const opt=document.createElement("option"); opt.value=y; opt.text=y; if(y===now.getFullYear()) opt.selected=true; yearSelect.appendChild(opt);}
  renderCalendar(now.getMonth(),now.getFullYear());
}

function renderCalendar(month,year){
  calendarDays.innerHTML="";
  const total=new Date(year,month+1,0).getDate();
  for(let i=1;i<=total;i++){
    const div=document.createElement("div"); div.classList.add("day"); div.innerText=i;
    div.onclick=()=>{ calendarDays.querySelectorAll(".day").forEach(d=>d.classList.remove("selected")); div.classList.add("selected"); selectedDay=i; };
    calendarDays.appendChild(div);
  }
}

monthSelect.onchange=()=>renderCalendar(parseInt(monthSelect.value),parseInt(yearSelect.value));
yearSelect.onchange=()=>renderCalendar(parseInt(monthSelect.value),parseInt(yearSelect.value));

// ===== VIEW ATTENDANCE =====
viewAttendanceBtn.onclick = () => {
  if (!selectedDay) return alert("Select a day first!");
  const allData = JSON.parse(localStorage.getItem("attendance_" + currentUser)) || [];
  const selectedDate = `${selectedDay}/${parseInt(monthSelect.value)+1}/${yearSelect.value}`;
  const dayData = allData.find(d => d.date === selectedDate);
  if(!dayData) return alert("No attendance saved for this day!");
  let msg = `Attendance for ${selectedDate}:\n\n`;
  dayData.students.forEach(s => {
    const info = JSON.parse(s.info || JSON.stringify(s.info));
    msg += `${info.name} | Grade ${info.grade} ${info.section} | ${info.subject} => ${s.status}\n`;
  });
  alert(msg);
  calendarModal.classList.remove("active");
  selectedDay = null;
};
</script>
<script type="module" src="script.js"></script>
</body>
</html>


